<!doctype html>

<html>

<head>
    <meta charset="utf-8">
    <title>Spotter</title>
    <meta name="description" content="d3 and Angular">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">


    <!--tab stuff-->

    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.3/angular.js"></script>
    <!--<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.1.5/angular.min.js"></script>-->
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.3/angular-animate.js"></script>
    <script src="//angular-ui.github.io/bootstrap/ui-bootstrap-tpls-1.3.2.js"></script>

    <script src="javascripts/app.js"></script>
    <script src="javascripts/demoCtrl2.js"></script>
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">


</head>


<body ng-app="myApp">
<div class="row">
    <div class="col-md-6 col-md-offset-3" ng-controller="DemoCtrl2">

        <h1 class="h1">Spotter</h1>

        <input class="input" type="text" placeholder='Artist name' name="name" id="name" ng-model="name" value="name">
        <button class="b1 w3-btn w3-dark-grey w3-hover-black w3-round w3-tiny" ng-click="getArtist(name)">Search</button>
        <button class="b2 w3-btn w3-dark-grey w3-hover-black w3-round w3-tiny" ng-click="getAllArtists()">Show All Artists</button>

        <ul>
            <li ng-repeat="name in artists">{{name.artist}} Plays: {{name.popularity}} {{name.energy}} {{name.speechiness}}</li>
        </ul>


        <uib-tabset active="active">
            <uib-tab index="0" select="tabChanged(0)" heading="Danceability">Danceability describes how suitable a track is for dancing based on a combination of musical elements including tempo, rhythm stability, beat strength, and overall regularity.</uib-tab>
            <uib-tab index="1" select="tabChanged(1)" heading="Energy">Represents a perceptual measure of intensity and activity. Typically, energetic tracks feel fast, loud, and noisy. Perceptual features contributing to this attribute include dynamic range, perceived loudness, timbre, onset rate, and general entropy.</uib-tab>
            <uib-tab index="2" select="tabChanged(2)" heading="Vocals">Average presence of speech in an artistâ€™s songs based on top tracks.</uib-tab>
            <uib-tab index="3" select="tabChanged(3)" heading="Tempo">The overall estimated tempo of a track in beats per minute (BPM). In musical terminology, tempo is the speed or pace of a given piece and derives directly from the average beat duration.</uib-tab>
            <uib-tab index="4" select="tabChanged(4)" heading="Popularity">Number of listeners for an artist.</uib-tab>
            <uib-tab index="5" select="tabChanged(5)" heading="All">A combination of danceability, energy, and vocals.</uib-tab>
        </uib-tabset>
        <br>


        <d3-bars data="d3Data" label="title" on-click="d3OnClick(item)"></d3-bars>
        <br>
        <br>
        <span contenteditable="true" ng-bind="d3Data[0].title"> </span>
        <input type="text" ng-model="d3Data[0].score"></input>
        <button class="b3 w3-btn w3-dark-grey w3-hover-black w3-round w3-tiny" ng-click="getArtistData(0)">Update</button>
        <br>
        <span contenteditable="true" ng-bind="d3Data[1].title"> </span>
        <input type="text" ng-model="d3Data[1].score"></input>
        <button class="b3 w3-btn w3-dark-grey w3-hover-black w3-round w3-tiny" ng-click="getArtistData(1)">Update</button>
        <br>
        <span contenteditable="true" ng-bind="d3Data[2].title"> </span>
        <input type="text" ng-model="d3Data[2].score"></input>
        <button class="b3 w3-btn w3-dark-grey w3-hover-black w3-round w3-tiny" ng-click="getArtistData(2)">Update</button>
        <br>


        <style>
            .h1 {
                padding-top: 20px;
                padding-bottom: 20px;
                text-align: center;
            }
            .b1 {
                margin-left: 10px;
                margin-bottom: 50px;
            }
            .b2 {
                margin-left: 6px;
                margin-bottom: 50px;
            }
            .b3 {
                margin-left: 10px;
                margin-bottom: 1px;
            }
            .w3-btn {
                width: 120px;
            }
            .input {
                width: 100px;
                margin-left: 8px;
                margin-bottom: 0px;
            }
        </style>


    </div>
</div>


<script src="javascripts/d3.js"></script>
<script src="javascripts/demoCtrl2.js"></script>
<script src="javascripts/d3Basic.js"></script>

</body>



<head>
    <title>Spotter</title>
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
    <!--added for styling-->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="http://www.w3schools.com/lib/w3.css">

    <style type="text/css">
        #login, #loggedin {
            display: none;
        }
        .text-overflow {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            width: 500px;
        }
    </style>
</head>

<body>
<!--<input type="button" onclick="getTrack()" value="Click Me!">-->
<div class="container">
    <div id="login">
        <h1></h1>
        <a href="/login" class="btn btn-primary">Log in with Spotify</a>
    </div>
    <div id="loggedin">
        <div id="user-profile">
        </div>
        <div id="oauth">
        </div>
        <!--<button class="btn btn-default" id="obtain-new-token">Obtain new token using the refresh token</button>-->
    </div>
</div>

<script id="user-profile-template" type="text/x-handlebars-template">
    <h1>Login Successful!</h1>
    <div class="media">
        <div class="pull-left">
            <img class="media-object" width="150" src="{{images.0.url}}" />
        </div>
        <div class="media-body">
            <dl class="dl-horizontal">
                <dt>Name:</dt><dd class="clearfix">{{display_name}}</dd>
                <dt>ID:</dt><dd>{{id}}</dd>
                <dt>Email:</dt><dd>{{email}}</dd>
                <!--<dt>Spotify URI</dt><dd><a href="{{external_urls.spotify}}">{{external_urls.spotify}}</a></dd>-->
                <!--<dt>Link</dt><dd><a href="{{href}}">{{href}}</a></dd>-->
                <!--<dt>Profile Image</dt><dd class="clearfix"><a href="{{images.0.url}}">{{images.0.url}}</a></dd>-->
                <dt>Country</dt><dd>{{country}}</dd>
            </dl>
        </div>
    </div>
</script>

<script id="oauth-template" type="text/x-handlebars-template">
    <!--<h2>oAuth info</h2>-->
    <!--<dl class="dl-horizontal">-->
    <!--<dt>Access token</dt><dd class="text-overflow">{{access_token}}</dd>-->
    <!--<dt>Refresh token</dt><dd class="text-overflow">{{refresh_token}}></dd>-->
    </dl>
</script>

<script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/2.0.0-alpha.1/handlebars.min.js"></script>
<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
<script>
    (function() {

        /**
         * Obtains parameters from the hash of the URL
         * @return Object
         */
        function getHashParams() {
            var hashParams = {};
            var e, r = /([^&;=]+)=?([^&;]*)/g,
                    q = window.location.hash.substring(1);
            while ( e = r.exec(q)) {
                hashParams[e[1]] = decodeURIComponent(e[2]);
            }
            return hashParams;
        }

        var userProfileSource = document.getElementById('user-profile-template').innerHTML,
                userProfileTemplate = Handlebars.compile(userProfileSource),
                userProfilePlaceholder = document.getElementById('user-profile');

        var oauthSource = document.getElementById('oauth-template').innerHTML,
                oauthTemplate = Handlebars.compile(oauthSource),
                oauthPlaceholder = document.getElementById('oauth');

        var params = getHashParams();

        var access_token = params.access_token,
                refresh_token = params.refresh_token,
                error = params.error;

        if (error) {
            alert('There was an error during the authentication');
        } else {
            if (access_token) {
                // render oauth info
                oauthPlaceholder.innerHTML = oauthTemplate({
                    access_token: access_token,
                    refresh_token: refresh_token
                });

                $.ajax({
                    url: 'https://api.spotify.com/v1/me',
                    headers: {
                        'Authorization': 'Bearer ' + access_token
                    },
                    success: function(response) {
                        userProfilePlaceholder.innerHTML = userProfileTemplate(response);

                        $('#login').hide();
                        $('#loggedin').show();
                    }
                });
            } else {
                // render initial screen
                $('#login').show();
                $('#loggedin').hide();
            }

            document.getElementById('obtain-new-token').addEventListener('click', function() {
                $.ajax({
                    url: '/refresh_token',
                    data: {
                        'refresh_token': refresh_token
                    }
                }).done(function(data) {
                    access_token = data.access_token;
                    oauthPlaceholder.innerHTML = oauthTemplate({
                        access_token: access_token,
                        refresh_token: refresh_token
                    });
                });
            }, false);
        }
    })();
</script>
</html>

